
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
    @*<script src="~/Scripts/pages/r.js"></script>*@
    <title>r</title>
</head>
@using (Html.BeginForm())
            {
    @Html.AntiForgeryToken()
        }
<body ng-if="pgLoad" ng-cloak>
    <div ng-controller="rController" ng-init="relevantInitialize()">
        <input type="hidden" name="ClientID" id="ClientID" />
        <input type="hidden" name="PanelistID" id="PanelistID" />
        <input type="hidden" name="SurveyID" id="SurveyID" />
        <input type="hidden" name="GeoCodes" id="GeoCodes" />
        <input type="hidden" name="TimePeriod" id="TimePeriod" />
        <input type="hidden" name="RVIDCompleted" id="RVIDCompleted" value="0" />
        <input type="hidden" name="VID" id="VID" value="" />
        <input type="hidden" name="RequestCSOData" id="RequestCSOData" value="" />
    </div>
</body>

</html>
<script src="~/Scripts/jquery-1.12.4.js"></script>

<script type="text/javascript" src="https://d3op16id4dloxg.cloudfront.net/RelevantID4.js"></script> @*for relevant*@
<script type="text/javascript" src="https://js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js"></script> @*for max mind.*@
@*<script>

    getUrlVars = function () {
        var Url = window.location.href.toLowerCase();
        var vars = {};
        var parts = Url.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
            vars[key] = value;
        });
        return vars;
    }
    var uig = getUrlVars()['uig'];
    var ug = getUrlVars()['ug'];
    var pid = getUrlVars()["pid"];
    var cid = getUrlVars()["cid"];
    if (pid == undefined) {
        pid = '';
    }
    tid = getUrlVars()["tid"];
    if (tid == undefined) {
        tid = '';
    }
    usid = getUrlVars()["usid"];
    if (usid == undefined) {
        usid = '';
    }
    if (cid == undefined) {
        cid = '';
    }
    var GeoIp2Res = '';
    var rvid = '';
    var score = '';
    var totalScore = ''; //releventscore + fpfscore
    var fpfScore = '';
    var rvScores = '';
    var isNew = 0;

    //Invoke Relevant Methods.
    function callRVIDService() {
        debugger;
        populateInputFields();
        callRVIDNow();
    }

    function populateInputFields() {
        debugger;
        document.getElementById('ClientID').value = '7DAB107F-8B12-4C44-A1E3-B569F6932EEA';
        if (ug != '' && ug != null) {
            document.getElementById('PanelistID').value = ug;
            document.getElementById('SurveyID').value = pid; //for Registration
        }
        document.getElementById('GeoCodes').value = '1,' + "US";
        document.getElementById('TimePeriod').value = '';
    }

    window.RVIDResponseComplete = function () {
        document.getElementById('RVIDCompleted').value = "1";
        rvId = document.getElementById('RVid').value;
        score = document.getElementById('Score').value;
        profileScore = document.getElementById('FraudProfileScore').value;
        if (document.getElementById('isNew').value.toLowerCase() == "true") {
            isNew = 1;
        }
        else {
            isNew = 0;
        }
        fpfScore += document.getElementById('FPF1').value + ',';
        fpfScore += document.getElementById('FPF2').value + ',';
        fpfScore += document.getElementById('FPF3').value + ',';
        fpfScore += document.getElementById('FPF4').value + ',';
        fpfScore += document.getElementById('FPF5').value + ',';
        fpfScore += document.getElementById('FPF6').value + ',';
        fpfScore += document.getElementById('FPF7').value + ',';
        fpfScore += document.getElementById('FPF8').value + ',';
        fpfScore += document.getElementById('FPF9').value;
        totalScore += score + ';' + fpfScore + ';' + profileScore;
        saveRid();
        return true;
    }

    var RVIDNoResponse = function () {
        rvId = 'Relevant Fail';
        score = 0;
        totalScore = '0;0,0,0,0,0,0,0,0,0'
        saveRid();
    }
    function saveRid() {
        radiusData = { //search Information object
            geodata: GeoIp2Res,
            UserGuid: ug,
        }
        var url = "/cr/InsertValidations?usid=" + usid + "&uig=" + uig + '&cid=' + cid + '&isNew=' + isNew +
                       "&rvId=" + rvId + "&tscore=" + totalScore

        //$.ajax({
        //    type: "POST",
        //    url: url,
        //    data: data,
        //    success: success,
        //    dataType: dataType
        //})
        httpService.postData(url, radiusData, '', 1).then(function (data, status) {
            
            if (data != null) {
                // get user basic profile questions
                if (data.RedirectUrl != "" && data.RedirectUrl != undefined) {
                    window.location.href = data.RedirectUrl;
                }
                else {
                    window.location.href = "/reg/pii?uig=" + uig + "&ug=" + ug + "&cid=" + cid +
                                "&pid=" + pid + "&tid=" + tid + "&usid=" + usid;
                }
            }
        }, function (err) {
            //Redirect the Member to Error End Page, based on Org we need to redirect the members to respective end pages.
        });
    }

    (function () {
        try {
            callRVIDService();
        }
        catch (err) {
            console.log(err)
            window.location.href = "/reg/pii?uig=" + uig + "&ug=" + ug + "&cid=" + cid + "&pid=" + pid + "&tid=" + tid + "&usid=" + usid;
        }
    })();


</script>*@
@Html.Raw(JSNLog.JavascriptLogging.Configure())

<script src="~/Scripts/angular-cookies.min.js"></script>
<script src="~/Scripts/angular-translate.min.js" type="text/javascript"></script>
<script src="~/Scripts/angular-translate-loader-partial.js" type="text/javascript"></script>
<script src="~/Scripts/translate-pluggable-loader.js" type="text/javascript"></script>
<script type="text/javascript" src="~/Scripts/Services/customServices.js"></script>
<link rel="stylesheet" href="~/Content/bootstrap.min.css" />
<link href="/Content/app.css" rel="stylesheet" />
<link href="~/Content/loading-bar.css" rel="stylesheet" />
<link type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="~/Scripts/Services/translationService.js" type="text/javascript"></script>
<script>document.write("<script  type='text/javascript' src='/Scripts/require.js'  data-main='/Scripts/services/config.js?v=" + 2 + "' ><\/script>");</script>
